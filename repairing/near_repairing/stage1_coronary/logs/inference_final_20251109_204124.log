
======================================================================
Inference for Coronary
Checkpoint: ./checkpoints/Coronary_class9_shape_only_251109_092755/best.pth
Output directory: ./inference_results/
Total samples: 998
Resolution: 256
Threshold: 0.5
======================================================================

Loading model...
Model loaded successfully!

Generating refined masks...
  0%|          | 0/998 [00:00<?, ?it/s]  0%|          | 0/998 [00:00<?, ?it/s]
Traceback (most recent call last):
  File "/home/user/persistent/NeAR_fix_Public-Cardiac-CT-Dataset/NeAR/repairing/near_repairing/stage1_coronary/inference_coronary.py", line 192, in <module>
    main()
    ~~~~^^
  File "/home/user/persistent/NeAR_fix_Public-Cardiac-CT-Dataset/NeAR/repairing/near_repairing/stage1_coronary/inference_coronary.py", line 167, in main
    refined_prob = inference_single_sample(
        model=model,
    ...<2 lines>...
        batch_size=args.batch_size
    )
  File "/home/user/persistent/NeAR_fix_Public-Cardiac-CT-Dataset/NeAR/repairing/near_repairing/stage1_coronary/inference_coronary.py", line 96, in inference_single_sample
    pred_logit, _ = model(indices, batch_grid)  # (1, B, 1)
                    ~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "/home/user/miniconda3/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/user/miniconda3/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/user/persistent/NeAR_fix_Public-Cardiac-CT-Dataset/NeAR/repairing/near_repairing/stage1_coronary/../../../near/models/nn3d/model_shape_only.py", line 195, in forward
    _, out = self.decoder(encoded, grid)
             ~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/home/user/miniconda3/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1775, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/user/miniconda3/lib/python3.13/site-packages/torch/nn/modules/module.py", line 1786, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/user/persistent/NeAR_fix_Public-Cardiac-CT-Dataset/NeAR/repairing/near_repairing/stage1_coronary/../../../near/models/nn3d/model_shape_only.py", line 126, in forward
    implicit_feature_1 = F.grid_sample(feature_map_1,
                                       grid,
                                       mode="bilinear",
                                       align_corners=True)
  File "/home/user/miniconda3/lib/python3.13/site-packages/torch/nn/functional.py", line 5108, in grid_sample
    return torch.grid_sampler(input, grid, mode_enum, padding_mode_enum, align_corners)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: grid_sampler(): expected 5D input and grid with same number of dimensions, but got input with sizes [1, 64, 4, 4, 4] and grid with sizes [1, 8192, 3]
